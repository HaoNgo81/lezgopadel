<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>LezGo Padel ‚Äî Training Bank</title>
  <meta name="theme-color" content="#071226" />
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icon-192.png" sizes="192x192">
  <style>
    /* Reset & base */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0}
    body{
      font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:linear-gradient(180deg,#071226 0%,#04111a 100%);
      color:#e6eef6; -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
    }
    :root{
      --panel:#0b1220; --muted:#9aa7b3; --accent:#22c55e; --danger:#ef4444; --card-shadow:0 8px 22px rgba(2,6,23,.6);
    }
    .container{max-width:1100px;margin:12px auto;padding:12px;width:94%}

    /* ---------- Logo + header (REPLACE THIS BLOCK) ---------- */
header{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  margin-bottom:12px;
  padding-top:6px;
}

/* g√∏r logo responsivt og centreret */
#logo{
  width: min(60vw, 420px); /* max-bredde 420px, ellers 60% af viewport */
  max-height: 24vh;       /* ikke h√∏jere end 24% af viewport-h√∏jde */
  height: auto;
  display:block;
  margin: 0 auto;
  object-fit: contain;
}

/* controls (knapper + sprog) ‚Äî holder dem p√¶nt tilpasset */
.controls{
  display:flex;
  gap:12px;
  align-items:center;
  width:100%;
  justify-content:space-between;
  flex-wrap:wrap;
  padding: 0 6px; /* lidt luft til kanterne p√• mobil */
}

/* badges og knapper placering */
.badges{display:flex;gap:8px;align-items:center}
.badge{background:rgba(255,255,255,.06);padding:6px 10px;border-radius:8px;font-weight:700;color:var(--muted)}
/* knapper */
.btn{border:0;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}
.btn-primary{background:var(--accent);color:#05261a}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted);padding:10px 14px;border-radius:12px}
.btn-danger{background:var(--danger);color:#fff;border-radius:12px;padding:10px 14px}
/* --------------------------------------------------------- */


    /* Card */
    .card{background:var(--panel);border-radius:12px;padding:12px;box-shadow:var(--card-shadow);margin-bottom:12px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"],input[type="url"],input[type="number"],select,textarea{
      width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071226;color:inherit;font-size:15px;
    }
    textarea{min-height:80px;resize:vertical}
    .flex{display:flex;gap:10px;align-items:center}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}

    .actions-row{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap}
    .actions-left{display:flex;gap:10px;align-items:center}
    .actions-right{display:flex;gap:10px;align-items:center}

    .list{margin-top:10px}
    .exercise{display:flex;gap:10px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.03);align-items:flex-start}
    .tag{display:inline-block;background:rgba(255,255,255,.03);padding:6px 8px;border-radius:8px;margin-right:8px;font-size:13px}

    /* Session builder aside stacked on small screens */
    .two-column{display:grid;grid-template-columns:1fr 360px;gap:12px}
    @media (max-width:860px){ .two-column{grid-template-columns:1fr} .grid{grid-template-columns:1fr} }

    /* Mobile tweaks */
    @media (max-width:520px){
      #logo{height:90px;max-height:14vh}
      .btn{padding:10px 12px;font-weight:700}
      .card{padding:10px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img id="logo" src="/lezgo-logo.svg" alt="LezGo logo">
      <div class="controls">
        <div class="badges" id="badges"></div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="lang-select" style="padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:transparent;color:inherit">
            <option value="en">English</option>
            <option value="da">Dansk</option>
          </select>
          <button id="btn-buy" class="btn btn-primary">Buy access</button>
          <button id="btn-admin" class="btn btn-ghost">Admin login</button>
        </div>
      </div>
    </header>

    <!-- Form card -->
    <section class="card">
      <h3 style="margin:0 0 10px 0;color:var(--muted)" id="form-title">Add / Edit exercise (Padel)</h3>
      <form id="exercise-form" class="grid" onsubmit="return false;">
        <div style="grid-column:1 / -1">
          <label for="title" id="label-title">Title</label>
          <input id="title" type="text" placeholder="e.g. Forehand topspin drill">
        </div>

        <div>
          <label for="category">Category</label>
          <div class="flex">
            <select id="category" style="flex:1"></select>
          </div>
        </div>

        <div>
          <label for="players">Players</label>
          <select id="players"></select>
        </div>

        <div>
          <label for="duration">Duration (minutes)</label>
          <input id="duration" type="number" min="0" placeholder="20">
        </div>

        <div>
          <label for="level">Level</label>
          <select id="level"></select>
        </div>

        <div>
          <label for="intensity">Intensity</label>
          <select id="intensity"></select>
        </div>

        <div style="grid-column:1 / -1">
          <label for="link">Link (YouTube / Instagram / Facebook)</label>
          <input id="link" type="url" placeholder="https://...">
        </div>

        <div style="grid-column:1 / -1">
          <label for="description">Description (EN / DA)</label>
          <textarea id="description" placeholder="Short description"></textarea>
        </div>

        <div style="grid-column:1 / -1">
          <label for="tags">Tags (comma separated)</label>
          <input id="tags" type="text" placeholder="Cross, Down the line, From glass">
        </div>

        <div style="grid-column:1 / -1" class="actions-row">
          <div class="actions-left">
            <button id="save-btn" class="btn btn-primary">‚ûï Save exercise</button>
            <button id="clear-btn" class="btn btn-ghost">Clear form</button>
          </div>
          <div class="actions-right">
            <button id="delete-all-btn" class="btn btn-danger">üóëÔ∏è Delete all exercises</button>
          </div>
        </div>

        <div style="grid-column:1 / -1;margin-top:8px;color:var(--muted)" id="dup-note">
          Duplicate detection: the app warns if Title or Link already exists.
        </div>
      </form>
    </section>

    <!-- List and session builder -->
    <section class="card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:10px">
        <input id="search" type="text" placeholder="Search by title, tag or description..." style="flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071226;color:inherit">
        <select id="filter-category" style="padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071226;color:inherit">
          <option value="ALL">ALL</option>
        </select>
        <select id="filter-level" style="padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071226;color:inherit">
          <option value="ALL">All levels</option>
        </select>
        <button id="show-favorites" class="btn btn-ghost">Show favorites</button>
      </div>

      <div class="two-column">
        <div>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap">
            <button id="select-all" class="btn btn-ghost">Select all</button>
            <button id="add-selected" class="btn btn-primary">Add selected to session builder</button>
            <div style="margin-left:auto" id="selected-count">0 selected</div>
          </div>
          <div id="list" class="list"></div>
        </div>

        <aside class="card">
          <h4 style="margin:0 0 8px 0">Training Session Builder</h4>
          <label>Session name</label>
          <input id="session-name" type="text">
          <label style="margin-top:8px">Session description</label>
          <input id="session-desc" type="text">
          <label style="margin-top:8px">Selected exercises</label>
          <div id="session-items" style="max-height:220px;overflow:auto;padding-top:6px"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
            <div>Total time:</div><div id="session-total" style="font-weight:800">0 m</div>
            <div style="margin-left:auto" id="session-count">0 exercises</div>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="save-session" class="btn btn-primary">Save session</button>
            <button id="clear-session" class="btn btn-ghost">Clear builder</button>
          </div>
          <div id="session-lock-info" style="margin-top:10px;color:var(--muted)">Free users do not have access to Training Sessions. Please buy access.</div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,.04);margin:12px 0" />
          <h5 style="margin:8px 0 6px 0">Saved sessions</h5>
          <div id="sessions-list" style="max-height:160px;overflow:auto"></div>
        </aside>
      </div>
    </section>
  </div>

  <!-- Admin modal -->
  <div id="admin-modal" style="display:none;position:fixed;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:999">
    <div style="background:var(--panel);padding:12px;border-radius:8px;max-width:420px;margin:24px auto">
      <h3 style="margin-top:0">Admin login</h3>
      <input id="admin-password" type="password" placeholder="Password" style="width:100%;padding:10px;border-radius:6px;margin-bottom:10px">
      <div style="display:flex;justify-content:flex-end;gap:8px">
        <button id="admin-cancel" class="btn btn-ghost">Cancel</button>
        <button id="admin-submit" class="btn btn-primary">Login</button>
      </div>
    </div>
  </div>

<script>
/* ================== CONFIG & STORAGE KEYS ================== */
const ADMIN_PASSWORD = 'admin123'; // change locally
const EX_KEY = 'lezgo_exercises_v1';
const CATS_KEY = 'lezgo_categories_v1';
const LEVELS_KEY = 'lezgo_levels_v1';
const INTENSITIES_KEY = 'lezgo_intensities_v1';
const PLAYERS_KEY = 'lezgo_players_v1';
const SESS_KEY = 'lezgo_sessions_v1';

/* Defaults */
const DEFAULT_CATEGORIES = ["Back wall","Bandeja","Chiquita","Defense","Double wall","Ground stroke backhand","Ground stroke forehand","Groundstroke","Lob","Rolu","Serve","Serve Return","Side wall","Smash","Vibora","Volley"].sort();
const DEFAULT_LEVELS = ['Beginner','Intermediate','Advanced'];
const DEFAULT_INTENSITIES = ['Low','Medium','High'];
const DEFAULT_PLAYERS = ['1','2','3','4','1-2','1-3','1-4','2-3','2-4','3-4','Any','Add new...'];

/* State */
let exercises = [], categories = [], levels = [], intensities = [], playersList = [], sessions = [];
let editingId = null, selectedIds = new Set();

/* Utils */
const $ = id => document.getElementById(id);
const uid = () => 'id_'+Math.random().toString(36).slice(2,9);
const now = () => new Date().toISOString();
const isAdmin = () => localStorage.getItem('lezgo_is_admin') === '1';
const isPaid = () => localStorage.getItem('lezgo_is_paid') === '1';

/* Load/save */
function loadAll(){
  exercises = JSON.parse(localStorage.getItem(EX_KEY) || '[]');
  categories = JSON.parse(localStorage.getItem(CATS_KEY) || 'null') || DEFAULT_CATEGORIES.slice();
  levels = JSON.parse(localStorage.getItem(LEVELS_KEY) || 'null') || DEFAULT_LEVELS.slice();
  intensities = JSON.parse(localStorage.getItem(INTENSITIES_KEY) || 'null') || DEFAULT_INTENSITIES.slice();
  playersList = JSON.parse(localStorage.getItem(PLAYERS_KEY) || 'null') || DEFAULT_PLAYERS.slice();
  sessions = JSON.parse(localStorage.getItem(SESS_KEY) || '[]');
  saveCategories(); saveLevels(); saveIntensities(); savePlayers();
}
function saveExercises(){ localStorage.setItem(EX_KEY, JSON.stringify(exercises)); }
function saveCategories(){ localStorage.setItem(CATS_KEY, JSON.stringify(categories)); }
function saveLevels(){ localStorage.setItem(LEVELS_KEY, JSON.stringify(levels)); }
function saveIntensities(){ localStorage.setItem(INTENSITIES_KEY, JSON.stringify(intensities)); }
function savePlayers(){ localStorage.setItem(PLAYERS_KEY, JSON.stringify(playersList)); }
function saveSessions(){ localStorage.setItem(SESS_KEY, JSON.stringify(sessions)); }

/* Populate UI lists */
function populateCategory(){
  const sel = $('category'), filt = $('filter-category');
  sel.innerHTML=''; filt.innerHTML='<option value="ALL">ALL</option>';
  categories.slice().sort().forEach(c=>{
    const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o);
    const f=document.createElement('option'); f.value=c; f.textContent=c; filt.appendChild(f);
  });
  const add = document.createElement('option'); add.value='__ADD__'; add.textContent='Add new category...'; sel.appendChild(add);
  filt.value='ALL';
}
function populateLevelAndIntensity(){
  const lvl = $('level'), inten = $('intensity'), filterLevel = $('filter-level');
  lvl.innerHTML=''; inten.innerHTML=''; filterLevel.innerHTML='<option value="ALL">All levels</option>';
  levels.slice().sort().forEach(x=>{ const o=document.createElement('option'); o.value=x; o.textContent=x; lvl.appendChild(o); const f=document.createElement('option'); f.value=x; f.textContent=x; filterLevel.appendChild(f); });
  const addLvl = document.createElement('option'); addLvl.value='__ADD__'; addLvl.textContent='Add new level...'; lvl.appendChild(addLvl);
  intensities.slice().sort().forEach(x=>{ const o=document.createElement('option'); o.value=x; o.textContent=x; inten.appendChild(o); });
  const addInt = document.createElement('option'); addInt.value='__ADD__'; addInt.textContent='Add new intensity...'; inten.appendChild(addInt);
}
function populatePlayers(){
  const sel = $('players'); sel.innerHTML='';
  playersList.slice().forEach(p=>{ const o=document.createElement('option'); o.value=p; o.textContent=p; sel.appendChild(o); });
  if(!playersList.includes('Add new...')){ const add = document.createElement('option'); add.value='__ADD__'; add.textContent='Add new...'; sel.appendChild(add); }
}

/* Init */
function init(){
  loadAll();
  populateCategory();
  populateLevelAndIntensity();
  populatePlayers();
  bind();
  renderList();
  renderSessions();
  updateAdminUI();
  updatePaidUI();
}
function bind(){
  $('save-btn').addEventListener('click', onSave);
  $('clear-btn').addEventListener('click', e=>{ e.preventDefault(); clearForm(); });
  $('delete-all-btn').addEventListener('click', ()=>{ if(confirm('Delete ALL exercises?')){ exercises=[]; saveExercises(); renderList(); }});
  $('search').addEventListener('input', renderList);
  $('filter-category').addEventListener('change', renderList);
  $('filter-level').addEventListener('change', renderList);
  $('show-favorites').addEventListener('click', ()=>{ const b=$('show-favorites'); b.textContent = b.textContent==='Show favorites' ? 'Show all' : 'Show favorites'; renderList(); });

  $('category').addEventListener('change', e=>{ if(e.target.value==='__ADD__'){ const n=prompt('Add new category:'); if(n){ categories.push(n.trim()); saveCategories(); populateCategory(); } }});
  $('level').addEventListener('change', e=>{ if(e.target.value==='__ADD__'){ const n=prompt('Add new level:'); if(n){ levels.push(n.trim()); saveLevels(); populateLevelAndIntensity(); } }});
  $('intensity').addEventListener('change', e=>{ if(e.target.value==='__ADD__'){ const n=prompt('Add new intensity:'); if(n){ intensities.push(n.trim()); saveIntensities(); populateLevelAndIntensity(); } }});
  $('players').addEventListener('change', e=>{ if(e.target.value==='__ADD__' || e.target.value==='Add new...'){ const n=prompt('Add custom players option (e.g. "1-4"):'); if(n){ playersList.push(n.trim()); savePlayers(); populatePlayers(); } }});

  $('select-all').addEventListener('click', ()=>{ document.querySelectorAll('.select-checkbox').forEach(cb=>cb.checked=true); updateSelectedFromUI(); });
  $('add-selected').addEventListener('click', addSelectedToBuilder);
  $('save-session').addEventListener('click', saveSessionFromBuilder);
  $('clear-session').addEventListener('click', clearBuilder);

  $('btn-admin').addEventListener('click', ()=>openAdminModal());
  $('admin-cancel').addEventListener('click', ()=>closeAdminModal());
  $('admin-submit').addEventListener('click', ()=>{ const p=$('admin-password').value||''; if(p===ADMIN_PASSWORD){ localStorage.setItem('lezgo_is_admin','1'); closeAdminModal(); updateAdminUI(); alert('Admin enabled'); } else alert('Wrong password'); });

  $('btn-buy').addEventListener('click', ()=>{ if(isPaid()){ if(confirm('Revoke paid access?')){ localStorage.removeItem('lezgo_is_paid'); updatePaidUI(); } } else { if(confirm('Simulate purchase and grant paid access?')){ localStorage.setItem('lezgo_is_paid','1'); updatePaidUI(); } }});
  $('lang-select').addEventListener('change', ()=>renderList());
}

/* Admin / paid UI */
function updateAdminUI(){ const b=$('badges'); b.innerHTML=''; if(isAdmin()){ const e=document.createElement('div'); e.className='badge'; e.textContent='ADMIN'; const btn=document.createElement('button'); btn.className='btn btn-ghost'; btn.textContent='Logout'; btn.addEventListener('click', ()=>{ localStorage.removeItem('lezgo_is_admin'); updateAdminUI(); }); b.appendChild(e); b.appendChild(btn); } }
function updatePaidUI(){ if(isPaid()){ const e=document.createElement('div'); e.className='badge'; e.textContent='PAID'; $('badges').appendChild(e); } const locked = !isPaid() && !isAdmin(); $('save-session').disabled = locked; $('add-selected').disabled = locked; $('session-lock-info').style.display = locked ? 'block' : 'none'; }

/* Save / create exercise */
function clearForm(){ editingId=null; $('title').value=''; $('link').value=''; $('description').value=''; $('duration').value=''; $('tags').value=''; $('players').selectedIndex=0; $('category').selectedIndex=0; $('level').selectedIndex=0; $('intensity').selectedIndex=0; $('save-btn').textContent='‚ûï Save exercise'; }
function normalizeTags(raw){ if(!raw) return ''; return raw.split(',').map(t=>t.replace(/^#+/,'').trim()).filter(Boolean).join(', '); }
function detectDuplicate(title,link){ const t=(title||'').trim().toLowerCase(); const l=(link||'').trim(); return exercises.find(x => (x.title||'').trim().toLowerCase()===t || ((x.link||'')==l && l)); }
function onSave(e){
  e.preventDefault();
  const title=$('title').value.trim();
  if(!title){ alert('Please add a title'); return; }
  const link=$('link').value.trim();
  const dup = detectDuplicate(title,link);
  if(dup && (!editingId || dup.id!==editingId)){ alert('Duplicate detected (title or link).'); return; }
  const ex = {
    id: editingId||uid(),
    title, link,
    description: $('description').value.trim(),
    category: $('category').value==='__ADD__' ? '' : $('category').value,
    players: $('players').value,
    duration: Number($('duration').value)||0,
    level: $('level').value,
    intensity: $('intensity').value,
    tags: normalizeTags($('tags').value),
    favorite:false, created: now()
  };
  if(editingId){
    const i = exercises.findIndex(x=>x.id===editingId);
    if(i>-1) exercises[i]=Object.assign({},exercises[i],ex);
  } else exercises.unshift(ex);
  saveExercises();
  clearForm();
  renderList();
}

/* Render list */
function renderList(){
  const q = ($('search').value||'').toLowerCase().trim();
  const filterCat = $('filter-category').value;
  const levelFilter = $('filter-level').value;
  const lang = $('lang-select').value || 'en';
  const el = $('list'); el.innerHTML='';
  let items = exercises.slice();
  if(filterCat && filterCat!=='ALL') items = items.filter(i=>i.category===filterCat);
  if(levelFilter && levelFilter!=='ALL') items = items.filter(i=>i.level===levelFilter);
  if(q) items = items.filter(i => (i.title||'').toLowerCase().includes(q) || (i.description||'').toLowerCase().includes(q) || (i.tags||'').toLowerCase().includes(q));
  if(items.length===0){ el.innerHTML='<div style="color:var(--muted)">No exercises found ‚Äî try changing filters or create a new exercise.</div>'; return; }
  items.forEach(ex=>{
    const row=document.createElement('div'); row.className='exercise'; row.dataset.id=ex.id;
    const cb=document.createElement('input'); cb.type='checkbox'; cb.className='select-checkbox'; cb.style.marginTop='6px';
    cb.addEventListener('change', ()=>{ if(cb.checked) selectedIds.add(ex.id); else selectedIds.delete(ex.id); updateSelectedCount(); });
    row.appendChild(cb);
    const left=document.createElement('div'); left.style.flex='1';
    const title=document.createElement('div'); title.style.fontWeight='800'; title.style.fontSize='15px'; title.textContent = ex.title;
    left.appendChild(title);
    const meta=document.createElement('div'); meta.style.color='var(--muted)'; meta.style.marginTop='6px'; meta.textContent = `${ex.category||'Uncategorized'} ‚Ä¢ ${ex.level||''} ‚Ä¢ ${ex.players||''} ‚Ä¢ ${ex.duration?ex.duration+'m':''}`;
    left.appendChild(meta);
    if(ex.link){ const a=document.createElement('a'); a.href=ex.link; a.target='_blank'; a.textContent=ex.link; a.style.display='block'; a.style.marginTop='8px'; a.style.color='var(--muted)'; left.appendChild(a); }
    if(ex.tags){ const tagsWrap=document.createElement('div'); tagsWrap.style.marginTop='8px'; ex.tags.split(',').map(t=>t.trim()).filter(Boolean).forEach(t=>{ const s=document.createElement('span'); s.className='tag'; s.textContent=t; tagsWrap.appendChild(s); }); left.appendChild(tagsWrap); }
    row.appendChild(left);

    const right=document.createElement('div'); right.style.display='flex'; right.style.flexDirection='column'; right.style.gap='8px';
    const btnRow=document.createElement('div'); btnRow.style.display='flex'; btnRow.style.gap='8px';
    const edit=document.createElement('button'); edit.className='btn btn-ghost'; edit.textContent='Edit'; edit.addEventListener('click', ()=>editItem(ex.id));
    const del=document.createElement('button'); del.className='btn btn-ghost'; del.style.color='var(--danger)'; del.textContent='Delete'; del.addEventListener('click', ()=>{ if(confirm('Delete?')){ exercises = exercises.filter(x=>x.id!==ex.id); saveExercises(); renderList(); } });
    btnRow.appendChild(edit); btnRow.appendChild(del);
    right.appendChild(btnRow);
    row.appendChild(right);

    el.appendChild(row);
  });
  updateSelectedCount();
}

/* Edit item */
function editItem(id){
  const ex = exercises.find(x=>x.id===id); if(!ex) return;
  editingId = id;
  $('title').value = ex.title||'';
  $('link').value = ex.link||'';
  $('description').value = ex.description||'';
  $('category').value = ex.category||'';
  if(!playersList.includes(ex.players)){ playersList.push(ex.players); savePlayers(); populatePlayers(); }
  $('players').value = ex.players||playersList[0]||'';
  $('duration').value = ex.duration||'';
  $('level').value = ex.level||levels[0];
  $('intensity').value = ex.intensity||intensities[0];
  $('tags').value = ex.tags||'';
  $('save-btn').textContent = 'Save changes';
  window.scrollTo({top:0,behavior:'smooth'});
}

/* Selection & builder */
function updateSelectedCount(){ $('selected-count').textContent = selectedIds.size + ' selected'; }
function updateSelectedFromUI(){ selectedIds.clear(); document.querySelectorAll('.select-checkbox').forEach(cb=>{ if(cb.checked){ const id = cb.closest('.exercise').dataset.id; selectedIds.add(id);} }); updateSelectedCount(); }
function addSelectedToBuilder(){ if(!isPaid() && !isAdmin()){ alert('Upgrade required to use session builder.'); return; } updateSelectedFromUI(); if(selectedIds.size===0){ alert('No exercises selected'); return; } const builder = $('session-items'); Array.from(selectedIds).forEach(id=>{ if(builder.querySelector(`[data-id="${id}"]`)) return; const ex = exercises.find(x=>x.id===id); if(!ex) return; const row = document.createElement('div'); row.className='exercise'; row.dataset.id = ex.id; row.style.alignItems='center'; row.innerHTML = `<div style="flex:1"><div style="font-weight:700">${ex.title}</div><div style="color:var(--muted)">${ex.duration||0} m ‚Ä¢ ${ex.category||''}</div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost">Remove</button></div>`; row.querySelector('button').addEventListener('click', ()=>{ row.remove(); recalcSession(); }); builder.appendChild(row); }); recalcSession(); }
function recalcSession(){ const items = Array.from($('session-items').children); let t=0; items.forEach(it=>{ const ex = exercises.find(x=>x.id===it.dataset.id); if(ex) t += Number(ex.duration)||0; }); $('session-total').textContent = t + ' m'; $('session-count').textContent = items.length + ' exercises'; }
function clearBuilder(){ $('session-items').innerHTML=''; $('session-name').value=''; $('session-desc').value=''; recalcSession(); }
function saveSessionFromBuilder(){ if(!isPaid() && !isAdmin()){ alert('Upgrade required to save sessions.'); return; } const name = $('session-name').value.trim(); if(!name){ alert('Add a session name'); return; } const items = Array.from($('session-items').children).map(c=>c.dataset.id); const total = items.reduce((acc,id)=>{ const ex = exercises.find(x=>x.id===id); return acc + (ex?Number(ex.duration)||0:0); },0); const s = { id:uid(), name, description:$('session-desc').value||'', items, total, created: now() }; sessions.unshift(s); saveSessions(); renderSessions(); clearBuilder(); alert('Session saved'); }
function renderSessions(){ const el = $('sessions-list'); el.innerHTML=''; if(sessions.length===0){ el.innerHTML='<div style="color:var(--muted)">No saved sessions yet</div>'; return; } sessions.forEach(s=>{ const div=document.createElement('div'); div.className='exercise'; div.style.alignItems='center'; div.innerHTML = `<div style="flex:1"><div style="font-weight:800">${s.name}</div><div style="color:var(--muted)">${s.items.length} exercises ‚Ä¢ ${s.total} m</div></div><div style="display:flex;gap:8px"><button class="btn btn-ghost">Open</button><button class="btn btn-ghost" style="color:var(--danger)">Delete</button></div>`; div.querySelector('button').addEventListener('click', ()=>{ openSession(s.id); }); div.querySelectorAll('button')[1].addEventListener('click', ()=>{ if(confirm('Delete session?')){ sessions = sessions.filter(x=>x.id!==s.id); saveSessions(); renderSessions(); } }); el.appendChild(div); }); }

/* Open session */
function openSession(id){ const s = sessions.find(x=>x.id===id); if(!s) return; const lines = s.items.map(i=>{ const ex = exercises.find(x=>x.id===i); return ex ? `‚Ä¢ ${ex.title} (${ex.duration||0} m)` : '‚Ä¢ (missing)'; }); alert(`${s.name}\n\n${s.description||''}\n\n${lines.join('\n')}\n\nTotal: ${s.total} m`); }

/* Init & service worker register */
init();
if('serviceWorker' in navigator){ navigator.serviceWorker.register('/service-worker.js').catch(err=>console.warn('SW error',err)); }

/* small helpers for editing */
function openAdminModal(){ $('admin-modal').style.display='flex'; }
function closeAdminModal(){ $('admin-modal').style.display='none'; }
</script>
</body>
</html>
