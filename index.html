<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>LezGo Padel ‚Äî Training Bank</title>
  <meta name="theme-color" content="#0f1720" id="meta-theme-color" />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="ICON-192x192.png" sizes="192x192">

  <style>
    /* ---------- RESET ---------- */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0;overflow-x:hidden}
    body{font-family:Inter,system-ui,Arial,sans-serif;-webkit-font-smoothing:antialiased;transition:background .25s,color .25s}
    a{color:inherit}

    /* ---------- THEME VARIABLES (dark default = antracit) ---------- */
    :root{
      --bg-top: #0f1720;        /* antracit top */
      --bg-bottom: #071226;     /* antracit bottom */
      --panel: #0b1a25;         /* cards */
      --muted: #9aa7b3;
      --text: #e6eef6;
      --accent: #22c55e;
      --accent-dark: #0b4428;
      --danger: #ef4444;
      --card-shadow: 0 10px 28px rgba(2,6,23,.6);
      --border-soft: rgba(255,255,255,.04);
    }

    /* ---------- LIGHT MODE (soft grey) ---------- */
    body.light {
  --bg-top: #caced5;      /* m√∏rkere top */
  --bg-bottom: #bfc3cb;   /* m√∏rkere bund */
  --panel: #d8dce3;       /* panel lys gr√• */
  --muted: #3c4652;       /* m√∏rkere tekst */
  --text: #0b1220;
  --accent: #16a34a;
  --accent-dark: #106b37;
  --danger: #dc2626;
  --card-shadow: 0 6px 14px rgba(0,0,0,.12);
  --border-soft: rgba(0,0,0,.14);
}

    .app-bg{
      background: linear-gradient(180deg,var(--bg-top) 0%,var(--bg-bottom) 100%);
      color:var(--text);min-height:100vh;
    }

    .container{max-width:1100px;margin:14px auto;padding:12px;width:94%}

    /* ---------- HEADER / LOGO ---------- */
    header{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:12px;padding-top:8px}

    /* logo responsive + more visible in light mode but not too bright */
    #logo{width:min(62vw,520px);max-height:26vh;height:auto;display:block;margin:0 auto;object-fit:contain;transition:filter .18s,opacity .18s}
    body.light #logo{filter:brightness(0.85) saturate(1.1) contrast(1.08);opacity:0.98}

    .controls{display:flex;gap:12px;align-items:center;width:100%;justify-content:space-between;flex-wrap:wrap;padding:0 6px}

    .badges{display:flex;gap:8px;align-items:center}
    .badge{background:rgba(255,255,255,.04);padding:6px 10px;border-radius:8px;font-weight:700;color:var(--muted)}

    /* ---------- BUTTONS ---------- */
    .btn{border:0;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;background:transparent;color:var(--text);display:inline-flex;align-items:center;gap:8px}
    .btn-primary{background:var(--accent);color:#05261a;box-shadow:0 6px 14px rgba(0,0,0,.08)}
    .btn-primary:active{transform:translateY(1px)}
    .btn-ghost{background:transparent;border:1px solid var(--border-soft);color:var(--muted);padding:10px 12px}
    .btn-danger{background:var(--danger);color:#fff}

    /* ---------- THEME TOGGLE (fix icons + sizing) ---------- */
    .theme-toggle{
      height:48px; min-width:48px; display:inline-grid;place-items:center;
      border-radius:12px; border:1px solid var(--border-soft); background:transparent; cursor:pointer; padding:6px;
      transition:background .18s, border-color .18s, box-shadow .18s, transform .06s;
    }
    .theme-toggle:active{transform:translateY(1px)}
    .theme-toggle svg{width:22px;height:22px;display:block}

    /* Dark mode: yellow pill (visible) */
    body:not(.light) .theme-toggle{
      background:#facc15!important;border-color:#facc15!important;color:#000!important;box-shadow:0 10px 26px rgba(250,204,21,.16)
    }

    /* Light mode: white rounded tile with subtle border so icon fits nicely */
    body.light .theme-toggle{
      background:#ffffff!important;border-color:rgba(0,0,0,.08)!important;color:#000!important;box-shadow:0 6px 18px rgba(2,6,23,.06)
    }

    /* center icon color control */
    .theme-toggle svg path,.theme-toggle svg circle{stroke:currentColor;fill:none}

    /* ---------- CARD / FORM ---------- */
    .card{background:var(--panel);border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:var(--card-shadow);transition:background .2s,box-shadow .2s}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=url],input[type=number],select,textarea{
      width:100%;padding:12px;border-radius:10px;border:1px solid var(--border-soft);background:transparent;color:var(--text);font-size:15px;transition:border-color .15s,background .15s
    }
    textarea{min-height:84px;resize:vertical}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:680px){.grid{grid-template-columns:1fr}}

    .actions-row{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}

    /* ---------- LIST / SESSION ---------- */
    .two-column{display:grid;grid-template-columns:1fr 380px;gap:12px}
    @media(max-width:980px){.two-column{grid-template-columns:1fr}}

    .exercise{display:flex;gap:10px;padding:10px;border-radius:10px;border:1px solid var(--border-soft);align-items:flex-start}
    .tag{background:rgba(255,255,255,.03);padding:6px 8px;border-radius:8px;margin-right:8px;font-size:13px;display:inline-block}
    .actions-small{display:flex;flex-direction:column;gap:6px}

    /* ---------- MOBILE ---------- */
    @media(max-width:520px){
      #logo{width:min(74vw,420px);max-height:18vh}
      .theme-toggle{height:44px;min-width:44px}
    }
  </style>
</head>

<body class="app-bg">
  <div class="container">

    <!-- HEADER -->
    <header>
      <img id="logo" src="lezgo-logo.svg" alt="LezGo logo">

      <div class="controls">
        <div class="badges" id="badges"></div>

        <div style="display:flex;gap:10px;align-items:center">
          <select id="lang-select" style="padding:8px;border-radius:8px;border:1px solid var(--border-soft);background:transparent;color:var(--text)">
            <option value="en">English</option>
            <option value="da">Dansk</option>
          </select>

          <button id="btn-buy" class="btn btn-primary">Buy access</button>
          <button id="btn-admin" class="btn btn-ghost">Admin login</button>

          <!-- THEME TOGGLE -->
          <button id="theme-toggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme">
            <svg id="theme-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>
          </button>
        </div>
      </div>
    </header>

    <!-- FORM -->
    <section class="card">
      <h3 style="margin:0 0 10px 0;color:var(--muted)">Add / Edit exercise (Padel)</h3>

      <form id="exercise-form" class="grid" onsubmit="return false;">
        <div style="grid-column:1/-1;">
          <label>Title</label>
          <input id="title" type="text" placeholder="e.g. Forehand topspin drill">
        </div>

        <div>
          <label>Category</label>
          <select id="category"></select>
        </div>

        <div>
          <label>Players</label>
          <select id="players"></select>
        </div>

        <div>
          <label>Duration (minutes)</label>
          <input id="duration" type="number" min="0" placeholder="20">
        </div>

        <div>
          <label>Level</label>
          <select id="level"></select>
        </div>

        <div>
          <label>Intensity</label>
          <select id="intensity"></select>
        </div>

        <div style="grid-column:1/-1;">
          <label>Video link (YouTube / Instagram / Facebook)</label>
          <input id="link" type="url" placeholder="https://...">
        </div>

        <div style="grid-column:1/-1;">
          <label>Description</label>
          <textarea id="description" placeholder="Short description"></textarea>
        </div>

        <div style="grid-column:1/-1;">
          <label>Tags (comma separated)</label>
          <input id="tags" type="text" placeholder="e.g. Cross, Chiquita, Vibora">
        </div>

        <div class="actions-row" style="grid-column:1/-1;margin-top:4px;">
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="save-btn" class="btn btn-primary">‚ûï Save exercise</button>
            <button id="clear-btn" class="btn btn-ghost">Clear form</button>
          </div>

          <button id="delete-all-btn" class="btn btn-danger">üóëÔ∏è Delete all</button>
        </div>
      </form>
    </section>

    <!-- LIST + SESSION -->
    <section class="card">
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
        <input id="search" type="text" placeholder="Search..." style="flex:1;padding:10px;border-radius:10px;border:1px solid var(--border-soft);background:transparent;color:var(--text)">
        <select id="filter-category" style="padding:10px;border-radius:10px;border:1px solid var(--border-soft);background:transparent;color:var(--text)"><option>ALL</option></select>
        <select id="filter-level" style="padding:10px;border-radius:10px;border:1px solid var(--border-soft);background:transparent;color:var(--text)"><option>ALL</option></select>
        <button id="show-favorites" class="btn btn-ghost">Show favorites</button>
      </div>

      <div class="two-column">
        <div>
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap">
            <button id="select-all" class="btn btn-ghost">Select all</button>
            <button id="add-selected" class="btn btn-primary">Add to session</button>
            <div style="margin-left:auto" id="selected-count">0 selected</div>
          </div>

          <div id="list"></div>
        </div>

        <aside class="card">
          <h4 style="margin:0">Training Session Builder</h4>

          <label>Session name</label>
          <input id="session-name" type="text">

          <label style="margin-top:8px">Session description</label>
          <input id="session-desc" type="text">

          <label style="margin-top:8px">Exercises</label>
          <div id="session-items" style="max-height:240px;overflow:auto"></div>

          <div style="display:flex;gap:10px;align-items:center;margin-top:10px;">
            <div>Total:</div>
            <div id="session-total" style="font-weight:700">0 m</div>
            <div style="margin-left:auto" id="session-count">0 exercises</div>
          </div>

          <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
            <button id="save-session" class="btn btn-primary">Save session</button>
            <button id="clear-session" class="btn btn-ghost">Clear</button>
          </div>

          <div id="session-lock-info" style="margin-top:14px;color:var(--muted);display:none;">
            Free users cannot save or build sessions. Buy access to unlock.
          </div>

          <hr style="border:none;border-top:1px solid var(--border-soft);margin:14px 0">

          <h4 style="margin:0 0 6px 0;">Saved sessions</h4>
          <div id="sessions-list" style="max-height:200px;overflow:auto"></div>
        </aside>
      </div>
    </section>
  </div><!-- container end -->

  <!-- ADMIN MODAL -->
  <div id="admin-modal" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999">
    <div style="background:var(--panel);padding:14px;border-radius:10px;max-width:420px;width:92%">
      <h3 style="margin-top:0">Admin login</h3>
      <input id="admin-password" type="password" placeholder="Password" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-soft);margin-bottom:12px">
      <div style="display:flex;gap:12px;justify-content:flex-end">
        <button id="admin-cancel" class="btn btn-ghost">Cancel</button>
        <button id="admin-submit" class="btn btn-primary">Login</button>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script>
    /* CONFIG */
    const ADMIN_PASSWORD = "admin123";
    const EX_KEY = "lezgo_exercises_v1";
    const CAT_KEY = "lezgo_categories_v1";
    const LVL_KEY = "lezgo_levels_v1";
    const INT_KEY = "lezgo_intensities_v1";
    const PLR_KEY = "lezgo_players_v1";
    const SES_KEY = "lezgo_sessions_v1";

    const DEFAULT_CATEGORIES = ["Back wall","Bandeja","Chiquita","Defense","Double wall","Groundstroke","Lob","Serve","Smash","Vibora","Volley"].sort();
    const DEFAULT_LEVELS = ["Beginner","Intermediate","Advanced"];
    const DEFAULT_INT = ["Low","Medium","High"];
    const DEFAULT_PLAYERS = ["1","2","3","4","1-2","1-3","1-4","2-4","Any","Add new..."];

    /* STATE */
    let exercises = [];
    let categories = [];
    let levels = [];
    let intensities = [];
    let players = [];
    let sessions = [];
    let editingId = null;
    let selectedIds = new Set();

    const $ = id => document.getElementById(id);
    const uid = () => "id_" + Math.random().toString(36).slice(2,10);

    const isAdmin = () => localStorage.getItem("is_admin") === "1";
    const isPaid  = () => localStorage.getItem("is_paid") === "1";

    /* THEME */
    const THEME_KEY = 'lezgo_theme';
    function applyTheme(theme){
      if(theme === 'light'){
        document.body.classList.add('light');
        document.querySelector('#meta-theme-color').setAttribute('content','#eceff1');
        setThemeIcon('light');
      } else {
        document.body.classList.remove('light');
        document.querySelector('#meta-theme-color').setAttribute('content','#0f1720');
        setThemeIcon('dark');
      }
      localStorage.setItem(THEME_KEY, theme);
    }
    function toggleTheme(){
      const current = localStorage.getItem(THEME_KEY) || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      applyTheme(next);
    }
    function setThemeIcon(mode){
      const svg = document.getElementById('theme-icon');
      if(!svg) return;
      if(mode === 'light'){
        svg.innerHTML = '<path d="M12 3v2M12 19v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4M12 7a5 5 0 100 10 5 5 0 000-10z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>';
      } else {
        svg.innerHTML = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path>';
      }
    }

    /* STORAGE LOAD */
    function loadAll(){
      exercises   = JSON.parse(localStorage.getItem(EX_KEY) || "[]");
      categories  = JSON.parse(localStorage.getItem(CAT_KEY) || "null") || DEFAULT_CATEGORIES;
      levels      = JSON.parse(localStorage.getItem(LVL_KEY) || "null") || DEFAULT_LEVELS;
      intensities = JSON.parse(localStorage.getItem(INT_KEY) || "null") || DEFAULT_INT;
      players     = JSON.parse(localStorage.getItem(PLR_KEY) || "null") || DEFAULT_PLAYERS;
      sessions    = JSON.parse(localStorage.getItem(SES_KEY) || "[]");
      saveBase();
    }
    function saveBase(){
      localStorage.setItem(CAT_KEY, JSON.stringify(categories));
      localStorage.setItem(LVL_KEY, JSON.stringify(levels));
      localStorage.setItem(INT_KEY, JSON.stringify(intensities));
      localStorage.setItem(PLR_KEY, JSON.stringify(players));
    }

    /* POPULATE UI */
    function populateCategories(){
      const sel = $("category"); const fil = $("filter-category");
      sel.innerHTML=""; fil.innerHTML="<option>ALL</option>";
      categories.forEach(c=>{ let o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); let f=document.createElement("option"); f.value=c; f.textContent=c; fil.appendChild(f); });
      let add=document.createElement("option"); add.value="__ADD__"; add.textContent="Add new category..."; sel.appendChild(add);
    }
    function populateLevels(){
      const sel = $("level"); const fil = $("filter-level");
      sel.innerHTML=""; fil.innerHTML="<option>ALL</option>";
      levels.forEach(c=>{ let o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); let f=document.createElement("option"); f.value=c; f.textContent=c; fil.appendChild(f); });
      let add=document.createElement("option"); add.value="__ADD__"; add.textContent="Add new level..."; sel.appendChild(add);
    }
    function populateIntensity(){ const sel=$("intensity"); sel.innerHTML=""; intensities.forEach(c=>{ let o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); }); let add=document.createElement("option"); add.value="__ADD__"; add.textContent="Add new intensity..."; sel.appendChild(add); }
    function populatePlayers(){ const sel=$("players"); sel.innerHTML=""; players.forEach(c=>{ let o=document.createElement("option"); o.value=c; o.textContent=c; sel.appendChild(o); }); }

    /* INIT */
    function init(){
      const savedTheme = localStorage.getItem(THEME_KEY) || 'dark';
      applyTheme(savedTheme);
      loadAll();
      populateCategories();
      populateLevels();
      populateIntensity();
      populatePlayers();
      bindEvents();
      renderList();
      renderSessions();
      updateBadges();
      updateSessionLock();
    }

    /* EVENTS */
    function bindEvents(){
      $("theme-toggle").addEventListener("click", toggleTheme);
      $("btn-admin").addEventListener("click", ()=> $("admin-modal").style.display="flex");
      $("admin-cancel").addEventListener("click", ()=> $("admin-modal").style.display="none");
      $("admin-submit").addEventListener("click", ()=>{ if($("admin-password").value===ADMIN_PASSWORD){ localStorage.setItem("is_admin","1"); $("admin-modal").style.display="none"; updateBadges(); updateSessionLock(); alert('Admin enabled'); } else alert("Wrong password"); });

      $("btn-buy").addEventListener("click", ()=>{ if(isPaid()){ if(confirm("Disable paid access?")){ localStorage.removeItem("is_paid"); updateBadges(); updateSessionLock(); } } else { if(confirm("Simulate purchase?")){ localStorage.setItem("is_paid","1"); updateBadges(); updateSessionLock(); } } });

      $("category").addEventListener("change", e=>{ if(e.target.value==="__ADD__"){ let n=prompt("New category:"); if(n){ categories.push(n.trim()); saveBase(); populateCategories(); } }});
      $("level").addEventListener("change", e=>{ if(e.target.value==="__ADD__"){ let n=prompt("New level:"); if(n){ levels.push(n.trim()); saveBase(); populateLevels(); } }});
      $("intensity").addEventListener("change", e=>{ if(e.target.value==="__ADD__"){ let n=prompt("New intensity:"); if(n){ intensities.push(n.trim()); saveBase(); populateIntensity(); } }});
      $("players").addEventListener("change", e=>{ if(e.target.value==="Add new..."||e.target.value==="__ADD__"){ let n=prompt("Add new players range:"); if(n){ players.push(n.trim()); saveBase(); populatePlayers(); } }});

      $("save-btn").addEventListener("click", onSave);
      $("clear-btn").addEventListener("click", clearForm);
      $("delete-all-btn").addEventListener("click", ()=>{ if(confirm("Delete ALL exercises?")){ exercises=[]; localStorage.setItem(EX_KEY,"[]"); renderList(); }});

      $("search").addEventListener("input", renderList);
      $("filter-category").addEventListener("change", renderList);
      $("filter-level").addEventListener("change", renderList);

      $("show-favorites").addEventListener("click", ()=>{ let b=$("show-favorites"); b.textContent = b.textContent==="Show favorites" ? "Show all" : "Show favorites"; renderList(); });

      $("select-all").addEventListener("click", ()=>{ document.querySelectorAll(".select-item").forEach(ch=>ch.checked=true); updateSelectedSet(); });
      $("add-selected").addEventListener("click", addSelectedToSession);
      $("save-session").addEventListener("click", saveSession);
      $("clear-session").addEventListener("click", clearSessionBuilder);
    }

    /* SAVE EXERCISE */
    function onSave(){
      let title = $("title").value.trim(); if(!title){ alert("Enter title"); return; }
      let ex = { id: editingId || uid(), title, category: $("category").value, players: $("players").value, duration: Number($("duration").value||0), level: $("level").value, intensity: $("intensity").value, link: $("link").value.trim(), description: $("description").value.trim(), tags: normalizeTags($("tags").value.trim()), favorite:false };
      if(editingId){ let idx = exercises.findIndex(x=>x.id===editingId); if(idx>-1) exercises[idx]=ex; } else exercises.unshift(ex);
      localStorage.setItem(EX_KEY, JSON.stringify(exercises));
      clearForm(); renderList();
    }
    function normalizeTags(str){ if(!str) return ""; return str.split(",").map(t=>t.replace(/^#+/,"").trim()).filter(Boolean).join(", "); }
    function clearForm(){ editingId=null; $("title").value=""; $("category").selectedIndex=0; $("players").selectedIndex=0; $("duration").value=""; $("level").selectedIndex=0; $("intensity").selectedIndex=0; $("link").value=""; $("description").value=""; $("tags").value=""; $("save-btn").textContent="‚ûï Save exercise"; }

    /* RENDER LIST */
    function renderList(){
      let q = $("search").value.trim().toLowerCase();
      let fc = $("filter-category").value; let fl = $("filter-level").value;
      let list = $("list"); list.innerHTML="";
      let items = exercises.slice();
      if(fc && fc!=="ALL") items = items.filter(x=>x.category===fc);
      if(fl && fl!=="ALL") items = items.filter(x=>x.level===fl);
      if(q) items = items.filter(x => x.title.toLowerCase().includes(q) || (x.description||"").toLowerCase().includes(q) || (x.tags||"").toLowerCase().includes(q) );
      if($("show-favorites").textContent==="Show all") items = items.filter(x=>x.favorite);
      if(items.length===0){ list.innerHTML = `<div style="color:var(--muted)">No matches</div>`; return; }
      items.forEach(ex=>{
        let row=document.createElement("div"); row.className="exercise"; row.dataset.id=ex.id;
        let cb=document.createElement("input"); cb.type="checkbox"; cb.className="select-item"; cb.addEventListener("change", updateSelectedSet); row.appendChild(cb);
        let left=document.createElement("div"); left.style.flex="1";
        let t=document.createElement("div"); t.style.fontWeight="800"; t.style.fontSize="15px"; t.textContent=ex.title; left.appendChild(t);
        let meta=document.createElement("div"); meta.style.color="var(--muted)"; meta.style.marginTop="6px"; meta.textContent = `${ex.category} ‚Ä¢ ${ex.level} ‚Ä¢ ${ex.players} ‚Ä¢ ${ex.duration}m`; left.appendChild(meta);
        if(ex.link){ let a=document.createElement("a"); a.href=ex.link; a.target="_blank"; a.textContent=ex.link; a.style.color="var(--muted)"; a.style.display="block"; a.style.marginTop="6px"; left.appendChild(a); }
        if(ex.tags){ let tags=document.createElement("div"); tags.style.marginTop="8px"; ex.tags.split(",").forEach(tg=>{ let s=document.createElement("span"); s.className="tag"; s.textContent=tg.trim(); tags.appendChild(s); }); left.appendChild(tags); }
        row.appendChild(left);
        let right=document.createElement("div"); right.className="actions-small";
        let edit=document.createElement("button"); edit.className="btn btn-ghost"; edit.textContent="Edit"; edit.addEventListener("click", ()=>editItem(ex.id));
        let del=document.createElement("button"); del.className="btn btn-ghost"; del.style.color="var(--danger)"; del.textContent="Delete"; del.addEventListener("click", ()=>{ if(confirm("Delete item?")){ exercises = exercises.filter(x=>x.id!==ex.id); localStorage.setItem(EX_KEY, JSON.stringify(exercises)); renderList(); }});
        right.appendChild(edit); right.appendChild(del);
        row.appendChild(right);
        list.appendChild(row);
      });
      updateSelectedSet();
    }

    function editItem(id){
      let ex = exercises.find(x=>x.id===id); if(!ex) return;
      editingId=id; $("title").value=ex.title; $("category").value=ex.category; $("players").value=ex.players; $("duration").value=ex.duration; $("level").value=ex.level; $("intensity").value=ex.intensity; $("link").value=ex.link; $("description").value=ex.description; $("tags").value=ex.tags; $("save-btn").textContent="Save changes"; window.scrollTo({top:0,behavior:"smooth"});
    }

    /* SESSION BUILDER */
    function updateSelectedSet(){ selectedIds.clear(); document.querySelectorAll(".select-item").forEach(cb=>{ if(cb.checked) selectedIds.add(cb.closest(".exercise").dataset.id); }); $("selected-count").textContent = selectedIds.size + " selected"; }
    function addSelectedToSession(){
      if(!isPaid() && !isAdmin()){ alert("Paid access required."); return; }
      let box=$("session-items");
      selectedIds.forEach(id=>{ if(box.querySelector(`[data-id="${id}"]`)) return; let ex=exercises.find(x=>x.id===id); if(!ex) return;
        let row=document.createElement("div"); row.className="exercise"; row.dataset.id=id;
        row.innerHTML=`<div style="flex:1"><div style="font-weight:700">${ex.title}</div><div style="color:var(--muted)">${ex.duration}m ‚Ä¢ ${ex.category}</div></div><button class="btn btn-ghost" style="color:var(--danger)">Remove</button>`;
        row.querySelector("button").addEventListener("click", ()=>{ row.remove(); recalcSession(); });
        box.appendChild(row);
      });
      recalcSession();
    }
    function recalcSession(){ let total=0,count=0; document.querySelectorAll("#session-items .exercise").forEach(row=>{ let ex=exercises.find(x=>x.id===row.dataset.id); if(ex){ total+=ex.duration; count++; }}); $("session-total").textContent=total+" m"; $("session-count").textContent=count+" exercises"; }
    function clearSessionBuilder(){ $("session-items").innerHTML=""; $("session-name").value=""; $("session-desc").value=""; recalcSession(); }
    function saveSession(){ if(!isPaid() && !isAdmin()){ alert("Paid access required."); return; } let name=$("session-name").value.trim(); if(!name){ alert("Add a session name"); return; } let ids=[]; document.querySelectorAll("#session-items .exercise").forEach(r=>ids.push(r.dataset.id)); let total = ids.reduce((a,id)=>{ let ex=exercises.find(x=>x.id===id); return a+(ex?ex.duration:0); },0); let ses={id:uid(),name,description:$("session-desc").value,items:ids,total}; sessions.unshift(ses); localStorage.setItem(SES_KEY, JSON.stringify(sessions)); renderSessions(); clearSessionBuilder(); }
    function renderSessions(){ let box=$("sessions-list"); box.innerHTML=""; if(sessions.length===0){ box.innerHTML=`<div style="color:var(--muted)">No sessions saved</div>`; return; } sessions.forEach(s=>{ let div=document.createElement("div"); div.className="exercise"; div.innerHTML=`<div style="flex:1"><div style="font-weight:800">${s.name}</div><div style="color:var(--muted)">${s.items.length} exercises ‚Ä¢ ${s.total} m</div></div><button class="btn btn-ghost">Open</button><button class="btn btn-ghost" style="color:var(--danger)">Delete</button>`; let btns=div.querySelectorAll("button"); btns[0].addEventListener("click", ()=>alert("Coming soon: detailed view")); btns[1].addEventListener("click", ()=>{ if(confirm("Delete session?")){ sessions = sessions.filter(x=>x.id!==s.id); localStorage.setItem(SES_KEY, JSON.stringify(sessions)); renderSessions(); } }); box.appendChild(div); }); }

    /* BADGES + LOCK */
    function updateBadges(){ $("badges").innerHTML=""; if(isAdmin()){ let d=document.createElement("div"); d.className="badge"; d.textContent="ADMIN"; $("badges").appendChild(d); } if(isPaid()){ let d=document.createElement("div"); d.className="badge"; d.textContent="PAID"; $("badges").appendChild(d); } }
    function updateSessionLock(){ let locked = (!isPaid() && !isAdmin()); $("save-session").disabled=locked; $("add-selected").disabled=locked; $("session-lock-info").style.display = locked ? "block":"none"; }

    /* START */
    init();

    /* REGISTER SERVICE WORKER */
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("service-worker.js").catch(err=>console.warn("SW failed:",err));
    }
  </script>
</body>
</html>
