<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>LezGo Padel ‚Äî Training Bank</title>
<meta name="theme-color" content="#0f1720" id="meta-theme-color" />

<style>
*,*::before,*::after{box-sizing:border-box}
html,body{height:100%;margin:0;padding:0;overflow-x:hidden;font-family:Inter,system-ui,Arial,sans-serif;-webkit-font-smoothing:antialiased}
:root{
--bg-top:#0f1720;--bg-bottom:#071226;--panel:#12202a;--muted:#9aa7b3;--text:#e6eef6;
--accent:#22c55e;--danger:#ef4444;--border-soft:rgba(255,255,255,.04);
--base-font:14px; --small-font:12px; --tiny-font:11px;
--select-font-desktop:16px; --select-font-mobile:13px;
--select-padding-desktop:10px 14px; --select-padding-mobile:8px 10px;
}
body.light{--bg-top:#caced5;--bg-bottom:#bfc3cb;--panel:#d8dce3;--muted:#3c4652;--text:#0b1220;--accent:#16a34a;--danger:#dc2626}
body{background:linear-gradient(180deg,var(--bg-top) 0%,var(--bg-bottom) 100%);color:var(--text);padding-bottom:140px;transition:background .2s,color .2s;font-size:var(--base-font)}

.container{max-width:1100px;margin:10px auto;padding:8px;width:94%}

header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;padding-top:env(safe-area-inset-top,12px);margin-bottom:8px;position:relative}
#logo-line{grid-column:2/3;display:flex;justify-content:center;align-items:center;margin:0}
#logo{height:50px;max-width:95%}

#top-controls{grid-column:3/4;justify-self:end;display:flex;gap:8px;align-items:center;z-index:40;white-space:nowrap}
#top-controls .theme-btn{display:inline-flex;align-items:center;justify-content:center;min-width:36px;height:36px;border-radius:9px;background:var(--panel);border:1px solid var(--border-soft);box-shadow:0 6px 14px rgba(0,0,0,.22);cursor:pointer;font-size:var(--small-font)}
#top-controls select{padding:6px 8px;border-radius:9px;border:1px solid var(--border-soft);background:transparent;color:var(--text);min-width:54px;font-weight:700;font-size:var(--small-font)}

.header-row{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-top:10px}
.badge{background:rgba(255,255,255,.04);padding:6px 10px;border-radius:8px;font-weight:700;color:var(--muted);font-size:var(--small-font)}

.btn{border:0;padding:8px 12px;border-radius:10px;font-weight:800;cursor:pointer;background:transparent;color:var(--text);display:inline-flex;align-items:center;gap:6px;font-size:var(--small-font)}
.btn-primary{background:var(--accent);color:#05261a}
.btn-ghost{background:transparent;border:1px solid var(--border-soft);color:var(--muted);padding:6px 10px;border-radius:10px}
.btn-small{padding:6px 8px;border-radius:8px;font-weight:700}

.platform-btn{border-radius:8px;padding:6px 8px;border:1px solid var(--border-soft);background:transparent;color:var(--muted);cursor:pointer;font-size:var(--small-font)}
.platform-btn.active{background:var(--accent);color:#05261a;border-color:transparent;box-shadow:0 6px 18px rgba(0,0,0,.12)}

.card{background:var(--panel);border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 10px 28px rgba(2,6,23,.6)}
label{display:block;font-size:var(--small-font);color:var(--muted);margin-bottom:6px}
input[type=text],input[type=url],input[type=number],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-soft);background:transparent;color:var(--text);font-size:var(--small-font)}
textarea{min-height:80px;resize:vertical}

.two-col{display:grid;grid-template-columns:1fr 400px;gap:12px}
@media(max-width:980px){.two-col{grid-template-columns:1fr}}

.exercise{display:flex;gap:10px;padding:8px;border-radius:10px;border:1px solid var(--border-soft);align-items:flex-start;overflow:hidden}
.exercise .left{flex:1 1 auto;min-width:0}
.exercise .left .title{font-weight:800;font-size:14px;line-height:1.15}
.exercise .left .meta{color:var(--muted);margin-top:6px;font-size:var(--tiny-font)}
.exercise a.link-label{color:#7dd3fc;text-decoration:underline;font-size:var(--small-font);word-break:break-word;display:inline-block;margin-top:6px}

.tag-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;align-items:center}
.tag{display:inline-block;padding:5px 8px;border-radius:10px;background:rgba(255,255,255,0.03);font-size:11px;color:var(--text);white-space:nowrap;max-width:100%}

.actions-small{flex:0 0 auto;display:flex;flex-direction:column;gap:8px;align-items:flex-end}
.actions-small button{font-size:var(--tiny-font)}

#list{max-height:560px;overflow:auto}
#session-items{max-height:300px;overflow:auto}
#sessions-list .exercise{padding:7px;border-radius:8px}
#sessions-list .exercise .title{font-size:13px}
#sessions-list .exercise .meta{font-size:var(--tiny-font);color:var(--muted)}

#bottom-bar{position:fixed;bottom:12px;left:12px;right:12px;max-width:calc(1100px - 24px);margin:0 auto;display:flex;gap:12px;justify-content:center;align-items:center;padding:8px;border-radius:12px;z-index:9999;box-shadow:0 10px 28px rgba(0,0,0,0.16);background:linear-gradient(180deg,rgba(0,0,0,0.04),rgba(0,0,0,0.02))}
.bottom-btn{padding:8px 12px;border-radius:10px;background:var(--accent);color:#05261a;font-weight:800;font-size:var(--small-font)}
.bottom-btn.restore{background:transparent;border:1px solid var(--border-soft);color:var(--text)}
</style>
</head>

<body>
<div class="container">

<header>
  <div></div>
  <div id="logo-line">
    <img id="logo" src="lezgo-logo.svg" alt="LEZGO">
  </div>
  <div id="top-controls">
    <button id="theme-toggle" class="theme-btn">üåô</button>
    <select id="lang-select">
      <option value="da">DA</option>
      <option value="en">EN</option>
    </select>
  </div>
</header>
<div class="header-row">
  <div id="badges" style="display:flex;gap:8px;align-items:center"></div>

  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <button id="btn-buy" class="btn btn-primary" data-i18n="buy">K√∏b</button>
    <button id="btn-admin" class="btn btn-ghost" data-i18n="admin">Admin</button>
    <button id="btn-logout" class="btn btn-ghost" style="display:none;color:var(--danger)" data-i18n="logout">Log ud</button>
  </div>
</div>

<section class="card">
  <h3 id="form-title" style="margin:0 0 10px 0;color:var(--muted);font-size:var(--small-font)" data-i18n="formTitle">
    Tilf√∏j / Rediger √∏velse (Padel)
  </h3>

  <form id="exercise-form" onsubmit="return false;" style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
    <div style="grid-column:1/-1">
      <label id="label-title">Titel</label>
      <input id="title" type="text" placeholder="f.eks. Forehand topspin drill">
    </div>

    <div>
      <label id="label-category">Kategori</label>
      <select id="category"></select>
    </div>

    <div>
      <label id="label-players">Spillere</label>
      <select id="players"></select>
    </div>

    <div>
      <label id="label-duration">Varighed (min)</label>
      <input id="duration" type="number" min="0" placeholder="20">
    </div>

    <div>
      <label id="label-level">Niveau</label>
      <select id="level"></select>
    </div>

    <div>
      <label id="label-intensity">Intensitet</label>
      <select id="intensity"></select>
    </div>

    <div style="grid-column:1/-1">
      <label id="label-link">Videolink (YouTube / Instagram / Facebook)</label>
      <div style="display:flex;gap:8px;align-items:center">
        <input id="link" type="url" placeholder="https://..." style="flex:1">
        <button id="analyze-btn" class="btn btn-ghost">üîç</button>
      </div>
    </div>

    <div style="grid-column:1/-1">
      <label id="label-desc">Beskrivelse</label>
      <textarea id="description"></textarea>
    </div>

    <div style="grid-column:1/-1">
      <label id="label-tags">Tags (kommasepareret)</label>
      <input id="tags" type="text" placeholder="fx Cross, Chiquita, Vibora">
    </div>

    <div style="grid-column:1/-1;display:flex;justify-content:space-between;align-items:center;margin-top:6px">
      <div style="display:flex;gap:8px;align-items:center">
        <button id="save-btn" class="btn btn-primary" data-i18n="save">Gem</button>
        <button id="clear-btn" class="btn btn-ghost" data-i18n="clear">Ryd</button>
        <button id="cancel-edit-btn" class="btn btn-ghost" style="display:none" data-i18n="cancel">Annuller</button>
      </div>
      <button id="delete-all-btn" class="btn btn-ghost" style="display:none;color:var(--danger)" data-i18n="deleteAll">Slet alle</button>
    </div>
  </form>
</section>

<div class="two-col">
  <div class="card">
    <div style="display:flex;flex-direction:column;gap:10px">
      <div class="search-row">
        <input id="search" type="text" placeholder="S√∏g..." data-i18n-placeholder="search">
        <div style="display:flex;gap:6px">
          <button type="button" id="pf-y" class="platform-btn" data-platform="youtube">YT</button>
          <button type="button" id="pf-i" class="platform-btn" data-platform="instagram">IG</button>
          <button type="button" id="pf-f" class="platform-btn" data-platform="facebook">FB</button>
        </div>
      </div>

      <div style="display:flex;gap:8px">
        <select id="filter-category" style="flex:1"><option>ALL</option></select>
        <select id="filter-level" style="flex:1"><option>ALL</option></select>
      </div>

      <div id="filter-hint" style="color:var(--muted);font-size:var(--tiny-font)" data-i18n="filterHint">
        Filtre er her ‚Äî Session Builder er til h√∏jre. P√• small sk√¶rme stables de lodret.
      </div>

      <div id="list" style="margin-top:6px"></div>
      <div style="display:flex;justify-content:center">
        <button id="load-more" class="btn btn-ghost" style="display:none" data-i18n="loadMore">Vis flere</button>
      </div>
    </div>
  </div>

  <aside class="card">
    <h4 id="session-builder-title" style="margin:0 0 10px 0;font-size:var(--small-font)" data-i18n="sessionBuilderTitle">
      Training Session Builder
    </h4>

    <label id="sessionNameLabel" data-i18n="sessionName">Sessionsnavn</label>
    <input id="session-name" type="text">

    <label id="sessionDescLabel" style="margin-top:8px" data-i18n="sessionDesc">Sessionsbeskrivelse</label>
    <input id="session-desc" type="text">

    <label style="margin-top:8px" data-i18n="exercisesLabel">√òvelser</label>
    <div id="session-items" style="max-height:300px;overflow:auto"></div>

    <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
      <div id="totalLabel" style="font-size:var(--small-font)">Total:</div>
      <div id="session-total" style="font-weight:700">0 m</div>
      <div id="session-count" style="margin-left:auto;font-size:var(--small-font)">0 √∏velser</div>
    </div>

    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="save-session" class="btn btn-primary" data-i18n="saveSession">Gem</button>
      <button id="clear-session" class="btn btn-ghost" data-i18n="clearSession">Ryd</button>
      <button id="cancel-session-edit" class="btn btn-ghost" style="display:none" data-i18n="cancelSessionEdit">Fortryd</button>
    </div>

    <div id="session-lock-info" style="margin-top:12px;color:var(--muted);display:none;font-size:var(--tiny-font)"></div>

    <hr style="border:none;border-top:1px solid var(--border-soft);margin:12px 0;">
    <h4 id="savedSessionsTitle" style="margin:0 0 8px 0;font-size:var(--small-font)" data-i18n="savedSessions">
      Gemte sessioner
    </h4>
    <div id="sessions-list" style="max-height:340px;overflow:auto"></div>
  </aside>
</div>
</div>
<div id="admin-modal" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:999">
  <div style="background:var(--panel);padding:12px;border-radius:10px;max-width:420px;width:92%">
    <h3 id="adminModalTitle">Admin login</h3>
    <input id="admin-password" type="password" placeholder="Password"
      style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-soft);margin-bottom:12px;font-size:var(--small-font)">
    <div style="display:flex;gap:12px;justify-content:flex-end">
      <button id="admin-cancel" class="btn btn-ghost" data-i18n="adminCancel">Annuller</button>
      <button id="admin-submit" class="btn btn-primary" data-i18n="adminSubmit">Login</button>
    </div>
  </div>
</div>

<div id="confirm-modal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1000">
  <div style="background:var(--panel);padding:14px;border-radius:12px;max-width:420px;width:92%">
    <h3 id="confirm-title">Bekr√¶ft</h3>
    <p id="confirm-message" style="color:var(--muted)">Er du sikker?</p>
    <div style="display:flex;gap:10px;justify-content:flex-end">
      <button id="confirm-no" class="btn btn-ghost">Nej</button>
      <button id="confirm-yes" class="btn btn-ghost" style="color:var(--danger)">Ja</button>
    </div>
  </div>
</div>

<div id="bottom-bar" style="display:none">
  <button id="backup-btn" class="bottom-btn">Backup</button>
  <button id="restore-btn" class="bottom-btn restore">Restore</button>
</div>

<script>
/* ================= CONFIG ================= */
const ADMIN_PASSWORD="admin123";
const EX_KEY="lezgo_exercises_v5";
const SES_KEY="lezgo_sessions_v5";
const CAT_KEY="lezgo_categories_v5";
const LVL_KEY="lezgo_levels_v5";
const INT_KEY="lezgo_intensities_v5";
const PLR_KEY="lezgo_players_v5";
const THEME_KEY="lezgo_theme";
const LANG_KEY="lezgo_lang";

const DEFAULT_CATEGORIES=["Back wall","Bandeja","Chiquita","Defense","Double wall","Groundstroke","Lob","Serve","Smash","Vibora","Volley"].sort();
const DEFAULT_LEVELS=["Beginner","Intermediate","Advanced"];
const DEFAULT_INT=["Low","Medium","High"];
const DEFAULT_PLAYERS=["1","2","3","4","1-2","1-3","1-4","2-4","Any"];

/* ================= UTIL ================= */
const $=id=>document.getElementById(id);
const uid=()=> "id_"+Math.random().toString(36).slice(2,10);
const isAdmin=()=>localStorage.getItem("is_admin")==="1";
const isPaid=()=>localStorage.getItem("is_paid")==="1";

/* ================= STATE ================= */
let exercises=[],sessions=[],categories=[],levels=[],intensities=[],players=[];
let editingId=null,editingSessionId=null,originalSessionSnapshot=null;
let renderIndex=0;
const BATCH=100;
const platformState=new Set();

/* ================= STORAGE ================= */
function loadAll(){
  exercises=JSON.parse(localStorage.getItem(EX_KEY)||"[]");
  sessions=JSON.parse(localStorage.getItem(SES_KEY)||"[]");
  categories=JSON.parse(localStorage.getItem(CAT_KEY)||"null")||DEFAULT_CATEGORIES;
  levels=JSON.parse(localStorage.getItem(LVL_KEY)||"null")||DEFAULT_LEVELS;
  intensities=JSON.parse(localStorage.getItem(INT_KEY)||"null")||DEFAULT_INT;
  players=JSON.parse(localStorage.getItem(PLR_KEY)||"null")||DEFAULT_PLAYERS;
}
function persistAll(){
  localStorage.setItem(EX_KEY,JSON.stringify(exercises));
  localStorage.setItem(SES_KEY,JSON.stringify(sessions));
  localStorage.setItem(CAT_KEY,JSON.stringify(categories));
  localStorage.setItem(LVL_KEY,JSON.stringify(levels));
  localStorage.setItem(INT_KEY,JSON.stringify(intensities));
  localStorage.setItem(PLR_KEY,JSON.stringify(players));
}

/* ================= INIT ================= */
function init(){
  applyTheme(localStorage.getItem(THEME_KEY)||"dark");
  const lang=localStorage.getItem(LANG_KEY)||"da";
  $("lang-select").value=lang;
  loadAll();
  populateSelects();
  bindEvents();
  refreshUI();
}

/* ================= BACKUP (FILE PICKER) ================= */
async function doBackup(){
  if(!isAdmin()&&!isPaid()){alert("Admin eller Paid kr√¶ves");return;}
  const payload={exercises,sessions,categories,levels,intensities,players,exportedAt:new Date().toISOString()};
  const json=JSON.stringify(payload,null,2);
  try{
    if(window.showSaveFilePicker){
      const handle=await window.showSaveFilePicker({
        suggestedName:`lezgo_backup_${new Date().toISOString().slice(0,19).replace(/[:T]/g,"_")}.json`,
        types:[{description:"LezGo Backup",accept:{"application/json":[".json"]}}]
      });
      const w=await handle.createWritable();
      await w.write(json);await w.close();
      alert("Backup gemt");
    }else{
      const blob=new Blob([json],{type:"application/json"});
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download="lezgo_backup.json";
      a.click();
    }
  }catch(e){alert("Backup annulleret");}
}

/* ================= RESTORE (FILE PICKER) ================= */
async function doRestore(){
  if(!isAdmin()&&!isPaid()){alert("Admin eller Paid kr√¶ves");return;}
  let file;
  try{
    if(window.showOpenFilePicker){
      const [h]=await window.showOpenFilePicker({types:[{accept:{"application/json":[".json"]}}]});
      file=await h.getFile();
    }else{
      file=await legacyRestorePicker();
      if(!file)return;
    }
    const data=JSON.parse(await file.text());
    const merge=confirm("OK = MERGE (tilf√∏j)\nAnnuller = ERSTAT (overskriv)");
    if(merge){
      exercises.push(...(data.exercises||[]));
      sessions.push(...(data.sessions||[]));
    }else{
      exercises=data.exercises||[];
      sessions=data.sessions||[];
      categories=data.categories||DEFAULT_CATEGORIES;
      levels=data.levels||DEFAULT_LEVELS;
      intensities=data.intensities||DEFAULT_INT;
      players=data.players||DEFAULT_PLAYERS;
    }
    persistAll();refreshUI();
    alert("Gendannelse f√¶rdig");
  }catch(e){alert("Restore annulleret");}
}
function legacyRestorePicker(){
  return new Promise(res=>{
    const i=document.createElement("input");
    i.type="file";i.accept="application/json";
    i.onchange=()=>res(i.files[0]||null);
    i.click();
  });
}

/* ================= EVENTS ================= */
function bindEvents(){
  $("theme-toggle").onclick=()=>applyTheme(document.body.classList.contains("light")?"dark":"light");
  $("lang-select").onchange=e=>localStorage.setItem(LANG_KEY,e.target.value);
  $("btn-admin").onclick=()=>$("admin-modal").style.display="flex";
  $("admin-cancel").onclick=()=>$("admin-modal").style.display="none";
  $("admin-submit").onclick=()=>{
    if($("admin-password").value===ADMIN_PASSWORD){
      localStorage.setItem("is_admin","1");
      $("admin-modal").style.display="none";
      refreshUI();
    }else alert("Forkert kode");
  };
  $("btn-logout").onclick=()=>{localStorage.removeItem("is_admin");refreshUI();};
  $("backup-btn").onclick=doBackup;
  $("restore-btn").onclick=doRestore;
}

/* ================= UI ================= */
function populateSelects(){}
function refreshUI(){
  $("bottom-bar").style.display=(isAdmin()||isPaid())?"flex":"none";
}

/* ================= THEME ================= */
function applyTheme(t){
  if(t==="light"){document.body.classList.add("light");$("theme-toggle").textContent="üåû";}
  else{document.body.classList.remove("light");$("theme-toggle").textContent="üåô";}
  localStorage.setItem(THEME_KEY,t);
}

/* ================= BOOT ================= */
document.addEventListener("DOMContentLoaded",init);
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/lezgopadel/service-worker.js");
}
</script>

</body>
</html>
